<Project DefaultTargets="Test">
  <Import Sdk="Microsoft.DotNet.Helix.Sdk" Project="Sdk.props"/>

  <PropertyGroup>
    <TargetFramework>netcoreapp3.1</TargetFramework>
    <!-- Workaround changes from newer MSBuild requiring additional properties, see https://github.com/dotnet/arcade/pull/5996 -->
    <TargetFrameworkVersion>3.1</TargetFrameworkVersion>
    <TargetFrameworkIdentifier>.NETCoreApp</TargetFrameworkIdentifier>
    <HelixType>test/product/</HelixType>
    <IncludeXHarnessCli>true</IncludeXHarnessCli>
    <TestRunNamePrefix>$(AGENT_JOBNAME)</TestRunNamePrefix>
    <EnableAzurePipelinesReporter>true</EnableAzurePipelinesReporter>
    <HelixBaseUri>https://helix.dot.net</HelixBaseUri>
    <!-- Pick up the nupkg from this repo for testing purposes -->
    <MicrosoftDotNetXHarnessCLIVersion>1.0.0-ci</MicrosoftDotNetXHarnessCLIVersion>
    <XHarnessNupkgPath>$(MSBuildThisFileDirectory)../../../artifacts/packages/$(Configuration)/Shipping/Microsoft.DotNet.XHarness.CLI.$(MicrosoftDotNetXHarnessCLIVersion).nupkg</XHarnessNupkgPath>

    <!-- Required: Version of XHarness CLI to use -->
    <IncludeXHarnessCli>true</IncludeXHarnessCli>

    <!-- Required: Version of XHarness CLI to use. Check the NuGet feed for current version: https://dev.azure.com/dnceng/public/_packaging?_a=package&feed=dotnet-eng&package=Microsoft.DotNet.XHarness.CLI&protocolType=NuGet -->
    <MicrosoftDotNetXHarnessCLIVersion>1.0.0-prerelease.20322.1</MicrosoftDotNetXHarnessCLIVersion>

    <!-- Optional: Properties that are also valid for the Arcade Helix SDK (some might be needed for CI runs only) -->
    <HelixType>test/product/</HelixType>
    <HelixBaseUri>https://helix.int-dot.net</HelixBaseUri>
    <Creator>$(BUILD_SOURCEVERSIONAUTHOR)</Creator>
    <EnableXUnitReporter>true</EnableXUnitReporter>
    <EnableAzurePipelinesReporter>true</EnableAzurePipelinesReporter>
  </PropertyGroup>

  <!-- Required: Configuration that is already needed for the Helix SDK -->
  <ItemGroup Condition=" '$(HelixAccessToken)' == '' ">
    <HelixTargetQueue Include="ubuntu.1804.amd64.android.open"/>
  </ItemGroup>

  <ItemGroup>
    <HelixWorkItem Include="Run Android tests">
      <Command Condition="$(IsPosixShell) != ''">dotnet exec $XHARNESS_CLI_PATH android device</Command>
      <Command Condition="$(IsPosixShell) == ''">dotnet exec %XHARNESS_CLI_PATH% android device</Command>
    </HelixWorkItem>
  </ItemGroup>
</Project>
